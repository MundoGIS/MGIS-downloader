<!DOCTYPE html>
<html lang="sv">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ladda ner GBIF-data</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" crossorigin="" />
  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
</head>

<body>
      <header class="main-header">
          <div class="brand-wrap">
              <img src="images/MGIS-logo_azul.png" alt="MGIS logo" class="site-logo">
              <div class="brand">LMV Data Downloader</div>
          </div>
          <nav>
            <a href="index.html">Hem</a>
            <a href="artdata.html" class="active">ArtData</a>
              <a href="lmv.html">Vektordata</a>
              <a href="lmv_hojd.html">H칬jddata</a>
              <a href="downloads.html">游닍 Nedladdningar</a>
          </nav>
      </header> 
  <div class="container">
    <h1>Ladda ner GBIF-data</h1>
    <form id="species-form">
      <label for="username">GBIF-anv칛ndarnamn:</label>
      <input type="text" id="username" name="username" required autocomplete="username">
      <label for="password">GBIF-l칬senord:</label>
      <input type="password" id="password" name="password" required autocomplete="current-password">
      <div class="checkbox-group">
        <input type="checkbox" id="remember-credentials">
        <label for="remember-credentials">Kom ih친g inloggning</label>
      </div>
      <div id="gbif-license" style="margin-top:8px; font-size:0.95em; color:#333;">Observera: GBIF-data kan ha olika licenser beroende p친 k칛lldataset. Kontrollera licensinformationen p친 GBIF innan du redistribuerar. Se 칛ven: <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener noreferrer">Licens: CC-BY-4.0</a></div>
      <div class="checkbox-group" style="margin-top:6px;">
        <input type="checkbox" id="accept-gbif-license">
        <label for="accept-gbif-license">Jag godk칛nner licensvillkoren f칬r data som h칛mtas via GBIF</label>
      </div>
      

      <label for="species-select">V칛lj art (eller alla):</label>
      <select id="species-select" name="species-select" required>
        <option value="" disabled selected>-- V칛lj en art eller "Alla arter" --</option>
        <option value="ALL">** Alla arter **</option>
        <option value="Tetrao urogallus">Tj칛der (Tetrao urogallus)</option>
        <option value="Pandion haliaetus">Fiskgjuse (Pandion haliaetus)</option>
        <option value="Gavia arctica">Storlom (Gavia arctica)</option>
        <option value="Gavia stellata">Sm친lom (Gavia stellata)</option>
      </select>

      <label for="basis-of-record-select">Typ av fynd:</label>
      <select id="basis-of-record-select" name="basis-of-record-select">
        <option value="" selected>-- Alla --</option>
        <option value="PRESERVED_SPECIMEN">Bevarat exemplar</option>
        <option value="HUMAN_OBSERVATION">M칛nsklig observation</option>
        <option value="OBSERVATION">Observation (generell)</option>
        <option value="MACHINE_OBSERVATION">Maskinobservation</option>
        <option value="MATERIAL_SAMPLE">Materialprov</option>
        <option value="LIVING_SPECIMEN">Levende exemplar</option>
        <option value="FOSSIL_SPECIMEN">Fossilt exemplar</option>
        <option value="LITERATURE">Litteratur</option>
        <option value="UNKNOWN">Ok칛nt</option>
      </select>

      <p class="info-text">Definiera omr친de genom att rita en rektangel p친 kartan ELLER fylla i
        koordinatf칛lten nedan.</p>
      <div id="mapid"></div>

      <fieldset class="coord-group">
        <legend>Eller ange koordinater manuellt</legend>
        <label for="min-lon">Min Lon:</label>
        <input type="number" step="any" id="min-lon" name="min-lon" placeholder="-180 till 180">
        <label for="max-lon">Max Lon:</label>
        <input type="number" step="any" id="max-lon" name="max-lon" placeholder="-180 till 180">
        <label for="min-lat">Min Lat:</label>
        <input type="number" step="any" id="min-lat" name="min-lat" placeholder="-90 till 90">
        <label for="max-lat">Max Lat:</label>
        <input type="number" step="any" id="max-lat" name="max-lat" placeholder="-90 till 90">
      </fieldset>

      <button type="submit" id="check-btn">Verifiera art / F칬rbered nedladdning</button>
    </form>

    <div id="result-message" style="margin-top: 15px;"></div>
    <div id="download-section" style="display: none; margin-top: 15px;">
      <p>Filter inst칛llda f칬r: <strong id="found-species-name"></strong> inom definierat omr친de.</p>
      <button id="download-btn">Starta nedladdning</button>
    </div>
    <div id="download-info" style="margin-top: 15px; display: none;">
      <p>Nedladdningsbeg칛ran har startats.</p>
      <p>Nedladdningsnyckel: <strong id="download-key"></strong></p>
      <p>Du kommer att f친 ett e-postmeddelande fr친n GBIF n칛r datan 칛r redo.</p>
      <p style="font-weight: bold; color: #d9534f;">VIKTIGT: N칛r du laddar ner .zip-filen fr친n GBIF-l칛nken, m친ste du
        spara eller manuellt flytta filen till din m친l-mapp:</p>
      <code
        style="background-color: #f0f0f0; padding: 2px 5px; border-radius: 3px;">O:\6_Projekt\GIS-Server\ArtData</code>
    </div>
    <br>
    <div>
      <a href="https://www.gbif.org/user/download" target="_blank" rel="noopener noreferrer">
        Logga in p친 GBIF f칬r att ladda ner (eller se status)
      </a>
    </div>
    <div>

    </div>
  </div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js" crossorigin=""></script>

  <script>
    // Sistema de almacenamiento seguro de credenciales
    (function() {
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const rememberCheckbox = document.getElementById('remember-credentials');
      
      // Cargar credenciales guardadas al inicio
      const savedUsername = localStorage.getItem('gbif_username');
      const savedPassword = localStorage.getItem('gbif_password');
      const rememberState = localStorage.getItem('gbif_remember') === 'true';
      
      if (rememberState && savedUsername && savedPassword) {
        usernameInput.value = savedUsername;
        passwordInput.value = atob(savedPassword); // Decodificar de Base64
        rememberCheckbox.checked = true;
      }
      
      // Guardar o eliminar credenciales cuando cambia el checkbox
      rememberCheckbox.addEventListener('change', function() {
        if (this.checked) {
          const username = usernameInput.value;
          const password = passwordInput.value;
          if (username && password) {
            localStorage.setItem('gbif_username', username);
            localStorage.setItem('gbif_password', btoa(password)); // Codificar en Base64
            localStorage.setItem('gbif_remember', 'true');
          }
        } else {
          localStorage.removeItem('gbif_username');
          localStorage.removeItem('gbif_password');
          localStorage.removeItem('gbif_remember');
        }
      });
      
      // Actualizar almacenamiento cuando se modifican los campos
      [usernameInput, passwordInput].forEach(input => {
        input.addEventListener('input', function() {
          if (rememberCheckbox.checked) {
            localStorage.setItem('gbif_username', usernameInput.value);
            localStorage.setItem('gbif_password', btoa(passwordInput.value));
          }
        });
      });
    })();
  </script>

  <script src="script.js"></script>
  <div id="global-notification" class="notification" style="display:none; position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); z-index:9999; width:min(900px,90%); text-align:center;"></div>
</body>

</html>